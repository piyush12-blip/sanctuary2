<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Organimo R&D - The Descent</title>
  
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,600&family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    body, html {
      margin: 0; padding: 0; background: #050510; color: #ffffff;
      font-family: 'Space Grotesk', sans-serif; overflow-x: hidden; width: 100%; cursor: none;
    }

    /* Custom Cursor */
    #cursor-dot, #cursor-ring {
      position: fixed; top: 0; left: 0; pointer-events: none; z-index: 10000;
      transform: translate(-50%, -50%); border-radius: 50%; will-change: transform;
    }
    #cursor-dot { width: 6px; height: 6px; background-color: #fff; mix-blend-mode: exclusion; }
    #cursor-ring { width: 40px; height: 40px; border: 1px solid rgba(255, 255, 255, 0.4); }

    canvas { display: block; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1; }

    #header {
      position: fixed; top: 0; left: 0; width: 100%; padding: 2.5rem;
      display: flex; justify-content: space-between; box-sizing: border-box;
      mix-blend-mode: exclusion; z-index: 100; pointer-events: none;
    }
    .logo { font-family: 'Playfair Display', serif; font-style: italic; font-size: 1.8rem; pointer-events: auto; }
    .nav { font-size: 1rem; letter-spacing: 4px; text-transform: uppercase; pointer-events: auto; }

    #scroll-container { height: 1200vh; width: 100vw; position: relative; }

    .story-text {
      position: fixed; left: 10vw; top: 50vh; transform: translateY(-50%);
      max-width: 500px; pointer-events: none; mix-blend-mode: exclusion; opacity: 0;
    }
    .split-word { display: inline-block; overflow: hidden; vertical-align: top; }
    .split-char { display: inline-block; transform: translateY(110%); will-change: transform; }

    h1 { font-family: 'Playfair Display', serif; font-size: 4rem; font-style: italic; margin: 0 0 1rem 0; line-height: 1.1; }
    p { font-size: 1.2rem; line-height: 1.6; opacity: 0.8; }

    #loading {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: #000; z-index: 999; display: flex; justify-content: center;
      align-items: center; letter-spacing: 4px; transition: opacity 1s ease;
    }
  </style>
</head>
<body>

  <div id="cursor-dot"></div>
  <div id="cursor-ring"></div>
  <div id="loading">LOADING EXPERIENCE...</div>

  <header id="header">
    <div class="logo magnetic">Organimo R&D</div>
    <div class="nav magnetic">The Descent</div>
  </header>

  <div id="scroll-container">
    <div class="story-text text-block" id="text-1" style="opacity: 1;">
      <h1 class="split-target">The Galactic Peak</h1>
      <p class="split-target">A monolithic origin in a sea of lavender mist and starlight.</p>
    </div>
    <div class="story-text text-block" id="text-2" style="left: auto; right: 10vw; text-align: right;">
      <h1 class="split-target">The Spiral Descent</h1>
      <p class="split-target">Floating isles and golden swimmers glint in the sunset.</p>
    </div>
    <div class="story-text text-block" id="text-3">
      <h1 class="split-target">The Sacred Shell</h1>
      <p class="split-target">Pink coral and a glowing pearl wait at the water's surface.</p>
    </div>
  </div>

  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
      "gsap": "https://unpkg.com/gsap@3.12.5/index.js",
      "gsap/ScrollTrigger": "https://unpkg.com/gsap@3.12.5/ScrollTrigger.js",
      "lenis": "https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.mjs"
    }
  }
  </script>

  <script type="module">
    import * as THREE from 'three';
    import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
    import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
    import { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
    import gsap from 'gsap';
    import ScrollTrigger from 'gsap/ScrollTrigger';
    import Lenis from 'lenis';

    gsap.registerPlugin(ScrollTrigger);

    // 0. Setup
    const isMobile = window.innerWidth <= 768;
    const pixelRatio = Math.min(window.devicePixelRatio, 2);
    const renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(pixelRatio);
    document.body.appendChild(renderer.domElement);

    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x050510, 0.02);
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 20, 40);

    // 1. Text Splitting
    function splitText(element) {
      const text = element.innerText;
      element.innerHTML = '';
      const words = text.split(' ');
      words.forEach((word, wordIndex) => {
        const wordSpan = document.createElement('span');
        wordSpan.classList.add('split-word');
        word.split('').forEach(char => {
          const charSpan = document.createElement('span');
          charSpan.classList.add('split-char');
          charSpan.innerHTML = char;
          wordSpan.appendChild(charSpan);
        });
        element.appendChild(wordSpan);
        if (wordIndex < words.length - 1) {
          const space = document.createElement('span');
          space.innerHTML = '&nbsp;';
          element.appendChild(space);
        }
      });
      return element.querySelectorAll('.split-char');
    }

    const textBlocksChunks = [];
    document.querySelectorAll('.text-block').forEach(block => {
      const targets = block.querySelectorAll('.split-target');
      let allChars = [];
      targets.forEach(t => allChars = [...allChars, ...splitText(t)]);
      textBlocksChunks.push(allChars);
    });

    // 2. Lights
    const ambientLight = new THREE.AmbientLight(0xffe5ec, 0.6);
    scene.add(ambientLight);
    const dirLight = new THREE.DirectionalLight(0xa594f9, 1.5);
    dirLight.position.set(10, 20, 10);
    scene.add(dirLight);

    // 3. Asset Loading
    const gltfLoader = new GLTFLoader();
    const allScenesGroup = new THREE.Group();
    scene.add(allScenesGroup);

    // Scene 1: Load YOUR Mountain
    const scene1Group = new THREE.Group();
    gltfLoader.load('mountain.glb', (gltf) => {
      const mountain = gltf.scene;
      mountain.scale.set(15, 15, 15);
      mountain.position.set(0, -10, 0);
      mountain.traverse(n => {
        if(n.isMesh) n.material = new THREE.MeshStandardMaterial({ color: 0x1a1a24, flatShading: true });
      });
      scene1Group.add(mountain);
      hideLoading(); // Hide only after mountain is ready
    }, undefined, (err) => {
        console.error("Mountain not found, using fallback.");
        hideLoading(); 
    });
    allScenesGroup.add(scene1Group);

    // 4. Smooth Scrolling (Lenis)
    const lenis = new Lenis();
    lenis.on('scroll', ScrollTrigger.update);
    gsap.ticker.add((time) => {
      lenis.raf(time * 1000);
    });

    // 5. Scroll Animations
    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: "#scroll-container",
        start: "top top", end: "bottom bottom", scrub: 1.5
      }
    });

    tl.to(camera.position, { x: 20, y: 15, z: 20 }, 0);
    tl.to(camera.position, { y: -50 }, 0.5);

    // Text Stagger Animations
    textBlocksChunks.forEach((chars, i) => {
      gsap.to(chars, {
        y: '0%', stagger: 0.02, ease: 'power3.out',
        scrollTrigger: {
          trigger: "#scroll-container",
          start: `${(i * 30)}% top`, end: `${(i * 30) + 10}% top`, scrub: 1
        }
      });
    });

    // 6. Fix for the Loading Screen
    function hideLoading() {
      const loaderUi = document.getElementById('loading');
      if (loaderUi) {
        loaderUi.style.opacity = 0;
        setTimeout(() => loaderUi.remove(), 1000);
      }
    }

    // Render Loop
    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }
    animate();

    // Window Resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
